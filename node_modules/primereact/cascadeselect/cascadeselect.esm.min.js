import*as e from"react";import n,{PrimeReactContext as t}from"primereact/api";import{ComponentBase as r,useHandleStyle as o}from"primereact/componentbase";import{CSSTransition as a}from"primereact/csstransition";import{useMountEffect as l,useUpdateEffect as i,useOverlayListener as c,useUnmountEffect as u}from"primereact/hooks";import{ChevronDownIcon as s}from"primereact/icons/chevrondown";import{OverlayService as p}from"primereact/overlayservice";import{Portal as d}from"primereact/portal";import{classNames as f,mergeProps as m,DomHandler as b,ObjectUtils as v,IconUtils as y,UniqueComponentId as h,ZIndexUtils as g}from"primereact/utils";import{AngleRightIcon as w}from"primereact/icons/angleright";import{Ripple as O}from"primereact/ripple";import{SpinnerIcon as S}from"primereact/icons/spinner";function E(){return E=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},E.apply(this,arguments)}function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function I(e,n){if("object"!==x(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function P(e){var n=I(e,"string");return"symbol"===x(n)?n:String(n)}function j(e,n,t){return(n=P(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function G(e){if(Array.isArray(e))return e}function C(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function D(e,n){if(e){if("string"==typeof e)return N(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?N(e,n):void 0}}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e,n){return G(e)||C(e,n)||D(e,n)||k()}var L=r.extend({defaultProps:{__TYPE:"CascadeSelect",appendTo:null,ariaLabelledBy:null,autoFocus:!1,breakpoint:void 0,className:null,dataKey:null,disabled:!1,loadingIcon:null,dropdownIcon:null,id:null,inputId:null,inputRef:null,itemTemplate:null,name:null,onBeforeHide:null,onBeforeShow:null,onChange:null,onGroupChange:null,onHide:null,onShow:null,optionGroupChildren:null,optionGroupIcon:null,optionGroupLabel:null,optionLabel:null,optionValue:null,options:null,placeholder:null,scrollHeight:"400px",style:null,tabIndex:null,transitionOptions:null,value:null,children:void 0},css:{classes:{root:function(e){var n=e.props,t=e.focusedState;return f("p-cascadeselect p-component p-inputwrapper",{"p-disabled":n.disabled,"p-focus":t,"p-inputwrapper-filled":n.value,"p-inputwrapper-focus":t||e.overlayVisibleState},n.className)},label:function(e){var n=e.props,t=e.label;return f("p-cascadeselect-label ",{"p-placeholder":t===n.placeholder,"p-cascadeselect-label-empty":!n.value&&"p-emptylabel"===t})},list:function(e){var t=e.context;return f("p-cascadeselect-panel p-cascadeselect-items",{"p-input-filled":t&&"filled"===t.inputStyle||"filled"===n.inputStyle,"p-ripple-disabled":t&&!1===t.ripple||!1===n.ripple})},sublist:"p-cascadeselect-panel p-cascadeselect-items p-cascadeselect-sublist",item:function(e){var n=e.option,t=e.activeOptionState;return f("p-cascadeselect-item",{"p-cascadeselect-item-group":(0,e.isOptionGroup)(n),"p-cascadeselect-item-active p-highlight":t===n})},dropdownIcon:"p-cascadeselect-trigger-icon",loadingIcon:"p-cascadeselect-trigger-icon",dropdownButton:"p-cascadeselect-trigger",loadingButton:"p-cascadeselect-trigger",wrapper:"p-cascadeselect-items-wrapper",panel:"p-cascadeselect-panel p-component",content:"p-cascadeselect-item-content",optionGroupIcon:"p-cascadeselect-group-icon",text:"p-cascadeselect-item-text",transition:"p-connected-overlay"},styles:"\n@layer primereact {\n    .p-cascadeselect {\n        display: inline-flex;\n        cursor: pointer;\n        position: relative;\n        user-select: none;\n    }\n    \n    .p-cascadeselect-trigger {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n    }\n    \n    .p-cascadeselect-label {\n        display: block;\n        white-space: nowrap;\n        overflow: hidden;\n        flex: 1 1 auto;\n        width: 1%;\n        text-overflow: ellipsis;\n        cursor: pointer;\n    }\n    \n    .p-cascadeselect-label-empty {\n        overflow: hidden;\n        visibility: hidden;\n    }\n    \n    .p-cascadeselect .p-cascadeselect-panel {\n        min-width: 100%;\n    }\n    \n    .p-cascadeselect-panel {\n        position: absolute;\n        top: 0;\n        left: 0;\n    }\n    \n    .p-cascadeselect-item {\n        cursor: pointer;\n        font-weight: normal;\n        white-space: nowrap;\n    }\n    \n    .p-cascadeselect-item-content {\n        display: flex;\n        align-items: center;\n        overflow: hidden;\n        position: relative;\n    }\n    \n    .p-cascadeselect-group-icon {\n        margin-left: auto;\n    }\n    \n    .p-cascadeselect-items {\n        margin: 0;\n        padding: 0;\n        list-style-type: none;\n        min-width: 100%;\n    }\n    \n    .p-fluid .p-cascadeselect {\n        display: flex;\n    }\n    \n    .p-fluid .p-cascadeselect .p-cascadeselect-label {\n        width: 1%;\n    }\n    \n    .p-cascadeselect-sublist {\n        position: absolute;\n        min-width: 100%;\n        z-index: 1;\n        display: none;\n    }\n    \n    .p-cascadeselect-item-active {\n        overflow: visible;\n    }\n    \n    .p-cascadeselect-item-active > .p-cascadeselect-sublist {\n        display: block;\n        left: 100%;\n        top: 0;\n    }\n}\n"}});function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach((function(n){j(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var T=e.memo((function(n){var r=A(e.useState(null),2),o=r[0],a=r[1],c=e.useRef(null),u=e.useContext(t),s=n.ptm,p=n.cx,d=function(e){return s(e,{hostName:n.hostName})},h=function(e){n.onOptionSelect&&n.onOptionSelect(e)},g=function(e,t){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var l=S(r);l&&l.children[0].focus();break;case"Up":case"ArrowUp":var i=x(r);i&&i.children[0].focus();break;case"Right":case"ArrowRight":C(t)&&(o===t?r.children[1].children[0].children[0].focus():a(t));break;case"Left":case"ArrowLeft":a(null);var c=e.currentTarget.parentElement.parentElement.previousElementSibling;c&&c.focus();break;case"Enter":I(e,t);break;case"Tab":case"Escape":n.onPanelHide&&(n.onPanelHide(),e.preventDefault())}e.preventDefault()},S=function e(n){var t=n.nextElementSibling;return t?b.hasClass(t,"p-disabled")||!b.hasClass(t,"p-cascadeselect-item")?e(t):t:null},x=function e(n){var t=n.previousElementSibling;return t?b.hasClass(t,"p-disabled")||!b.hasClass(t,"p-cascadeselect-item")?e(t):t:null},I=function(e,t){C(t)?(a((function(e){return e===t?null:t})),n.onOptionGroupSelect&&n.onOptionGroupSelect({originalEvent:e,value:t})):n.onOptionSelect&&n.onOptionSelect({originalEvent:e,value:G(t)})},P=function(e){n.onOptionGroupSelect&&n.onOptionGroupSelect(e)},j=function(e){return n.optionLabel?v.resolveFieldData(e,n.optionLabel):e},G=function(e){return n.optionValue?v.resolveFieldData(e,n.optionValue):e},C=function(e){return Object.prototype.hasOwnProperty.call(e,n.optionGroupChildren[n.level])},N=function(e){return C(e)?(t=e,n.optionGroupLabel?v.resolveFieldData(t,n.optionGroupLabel):null):j(e);var t};l((function(){if(n.selectionPath&&n.options&&!n.dirty){var e=n.options.find((function(e){return n.selectionPath.includes(e)}));e&&a(e)}var t,r,o,l,i;n.root||(r=b.getOffset(t=c.current.parentElement),o=b.getViewport(),l=c.current.offsetParent?c.current.offsetWidth:b.getHiddenElementOuterWidth(element),i=b.getOuterWidth(t.children[0]),parseInt(r.left,10)+i+l>o.width-b.calculateScrollbarWidth()&&(c.current.style.left="-100%"))})),i((function(){a(null)}),[n.parentActive]);var D=function(t){if(C(t)&&o===t){var r=v.resolveFieldData(t,n.optionGroupChildren[n.level]),a=o===t,l=n.level+1;return e.createElement(T,{hostName:n.hostName,options:r,className:p("sublist"),selectionPath:n.selectionPath,optionLabel:n.optionLabel,optionValue:n.optionValue,level:l,onOptionSelect:h,onOptionGroupSelect:P,parentActive:a,optionGroupLabel:n.optionGroupLabel,optionGroupChildren:n.optionGroupChildren,dirty:n.dirty,template:n.template,onPanelHide:n.onPanelHide,ptm:s,cx:p})}return null},k=function(t,r){var a=D(t),l=m({className:p("text")},d("text")),i=n.template?v.getJSXElement(n.template,G(t)):e.createElement("span",l,N(t)),c=m({className:p("optionGroupIcon")},d("optionGroupIcon")),u=n.optionGroupIcon||e.createElement(w,c),s=C(t)&&y.getJSXIcon(u,H({},c),{props:n}),b=N(t)+"_"+r,h=m({className:p("content"),onClick:function(e){return I(e,t)},tabIndex:0,onKeyDown:function(e){return g(e,t)}},d("content")),S=m({className:f(t.className,p("item",{option:t,isOptionGroup:C,activeOptionState:o})),style:t.style,role:"none","data-p-item-group":C(t),"data-p-highlight":o===t},d("item"));return e.createElement("li",E({key:b},S),e.createElement("div",h,i,s,e.createElement(O,null)),a)},L=n.options?n.options.map(k):null,R=m({ref:c,className:p(0===n.level?"list":"sublist",{context:u}),role:"listbox","aria-orientation":"horizontal"},d(0===n.level?"list":"sublist"));return e.createElement("ul",R,L)}));function B(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function V(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?B(Object(t),!0).forEach((function(n){j(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function F(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=K(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==t.return||t.return()}finally{if(i)throw a}}}}function K(e,n){if(e){if("string"==typeof e)return _(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_(e,n):void 0}}function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var M=e.memo(e.forwardRef((function(r,f){var w=e.useContext(t),O=L.getProps(r,w),x=A(e.useState(!1),2),I=x[0],P=x[1],j=A(e.useState(!1),2),G=j[0],C=j[1],N=A(e.useState(null),2),D=N[0],k=N[1],R=L.setMetaData({props:O,state:{focused:I,overlayVisible:G,attributeSelector:D}}),H=R.ptm,B=R.cx;o(L.css.styles,R.isUnstyled,{name:"cascadeselect"});var K=e.useRef(null),_=e.useRef(null),M=e.useRef(null),U=e.useRef(null),z=e.useRef(null),J=e.useRef(!1),W=e.useRef(null),X=A(c({target:K,overlay:_,listener:function(e,n){n.valid&&ue()},when:G}),2),Z=X[0],$=X[1],q=function(e){O.onChange&&O.onChange({originalEvent:e,value:e.value}),re(),ue(),b.focus(M.current)},Y=function(e){J.current=!0,O.onGroupChange&&O.onGroupChange(e)},Q=function(e){return(O.optionLabel?v.resolveFieldData(e,O.optionLabel):e)||e},ee=function(e){return O.optionValue?v.resolveFieldData(e,O.optionValue):e},ne=function(e,n){return v.resolveFieldData(e,O.optionGroupChildren[n])},te=function(e,n){return Object.prototype.hasOwnProperty.call(e,O.optionGroupChildren[n])},re=function(){var e;if(null!=O.value&&O.options){var n,t=F(O.options);try{for(t.s();!(n=t.n()).done;){if(e=oe(n.value,0))break}}catch(e){t.e(e)}finally{t.f()}}W.current=e},oe=function e(n,t){if(te(n,t)){var r,o,a=F(ne(n,t));try{for(a.s();!(o=a.n()).done;){if(r=e(o.value,t+1))return r.unshift(n),r}}catch(e){a.e(e)}finally{a.f()}}else if(v.equals(O.value,ee(n),O.dataKey))return[n];return null},ae=function(){P(!0)},le=function(){P(!1)},ie=function(e){switch(e.which){case 40:G?b.findSingle(_.current,".p-cascadeselect-item").children[0].focus():e.altKey&&O.options&&O.options.length&&ce(),e.preventDefault();break;case 32:G?ue():ce(),e.preventDefault();break;case 9:ue()}},ce=function(){O.onBeforeShow&&O.onBeforeShow(),C(!0)},ue=function(){O.onBeforeHide&&O.onBeforeHide(),C(!1),b.focus(M.current)},se=function(){g.set("overlay",_.current,w&&w.autoZIndex||n.autoZIndex,w&&w.zIndex.overlay||n.zIndex.overlay),b.addStyles(_.current,{position:"absolute",top:"0",left:"0"}),me(),D&&O.breakpoint&&(_.current.setAttribute(D+"_panel",""),be())},pe=function(){Z(),O.onShow&&O.onShow()},de=function(){$(),J.current=!1},fe=function(){g.clear(_.current),O.onHide&&O.onHide(),ve()},me=function(){b.alignOverlay(_.current,U.current.parentElement,O.appendTo||w&&w.appendTo||n.appendTo)},be=function(){if(!z.current){z.current=b.createInlineStyle(w&&w.nonce||n.nonce);var e="".concat(D,"_panel"),t="\n@media screen and (max-width: ".concat(O.breakpoint,") {\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-items-wrapper > ul {\n        max-height: ").concat(O.scrollHeight,";\n        overflow: ").concat(O.scrollHeight?"auto":"",";\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-sublist {\n        position: relative;\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-item-active > .p-cascadeselect-sublist {\n        left: 0;\n        box-shadow: none;\n        border-radius: 0;\n        padding: 0 0 0 calc(var(--inline-spacing) * 2); /* @todo */\n    }\n\n    .p-cascadeselect-panel[").concat(e,'] .p-cascadeselect-group-icon:before {\n        content: "\\e930";\n    }\n}\n');z.current.innerHTML=t}},ve=function(){z.current=b.removeInlineStyle(z.current)};e.useImperativeHandle(f,(function(){return{props:O,getElement:function(){return K.current},getOverlay:function(){return _.current},getInput:function(){return M.current},getLabel:function(){return U.current},focus:function(){return b.focus(M.current)}}})),l((function(){O.breakpoint&&!D&&k(h()),O.autoFocus&&b.focus(M.current,O.autoFocus),me()})),e.useEffect((function(){v.combinedRefs(M,O.inputRef)}),[M,O.inputRef]),i((function(){re()}),[O.value]),u((function(){g.clear(_.current)}));var ye=function(){var n=m({className:B("dropdownIcon")},H("dropdownIcon")),t=y.getJSXIcon(O.dropdownIcon||e.createElement(s,n),V({},n),{props:O}),r=m({className:B("dropdownButton"),role:"button","aria-haspopup":"listbox","aria-expanded":G},H("dropdownButton"));return e.createElement("div",r,t)},he=m({className:B("wrapper")},H("wrapper")),ge=m({ref:_,className:B("panel"),onClick:function(e){p.emit("overlay-click",{originalEvent:e,target:K.current})}},H("panel")),we=function(){var n=m({classNames:B("transition"),in:G,timeout:{enter:120,exit:100},options:O.transitionOptions,unmountOnExit:!0,onEnter:se,onEntered:pe,onExit:de,onExited:fe},H("transition")),t=e.createElement(a,E({nodeRef:_},n),e.createElement("div",ge,e.createElement("div",he,e.createElement(T,{hostName:"CascadeSelect",options:O.options,selectionPath:W.current,optionGroupIcon:O.optionGroupIcon,optionLabel:O.optionLabel,optionValue:O.optionValue,level:0,optionGroupLabel:O.optionGroupLabel,optionGroupChildren:O.optionGroupChildren,onOptionSelect:q,onOptionGroupSelect:Y,root:!0,template:O.itemTemplate,onPanelHide:ue,ptm:H,cx:B}))));return e.createElement(d,{element:t,appendTo:O.appendTo})},Oe=L.getOtherProps(O);v.reduceKeys(Oe,b.DATA_PROPS);var Se,Ee,xe,Ie,Pe,je,Ge,Ce,Ne,De,ke,Ae,Le,Re=v.reduceKeys(Oe,b.ARIA_PROPS);return Se=O.value?Q(O.value):void 0,Ee=m({className:"p-hidden-accessible"},H("hiddenSelectedMessage")),xe=m(V({ref:M,type:"text",id:O.inputId,name:O.name,defaultValue:Se,readOnly:!0,disabled:O.disabled,onFocus:ae,onBlur:le,onKeyDown:function(e){return ie(e)},tabIndex:O.tabIndex,"aria-haspopup":"listbox"},Re),H("input")),Ne=e.createElement("div",Ee,e.createElement("input",xe)),Ie=O.value?Q(O.value):O.placeholder||"p-emptylabel",Pe=m({ref:U,className:B("label",{label:Ie})},H("label")),De=e.createElement("span",Pe,Ie),ke=O.loading?(je=m({className:B("loadingIcon")},H("loadingIcon")),Ge=y.getJSXIcon(O.loadingIcon||e.createElement(S,{spin:!0}),V({},je),{props:O}),Ce=m({className:B("loadingButton"),role:"button","aria-haspopup":"listbox","aria-expanded":G},H("dropdownButton")),e.createElement("div",Ce,Ge)):ye(),Ae=we(),Le=m({id:O.id,ref:K,className:B("root",{focusedState:I,overlayVisibleState:G}),style:O.style,onClick:function(e){return n=e,void(O.disabled||O.loading||_.current&&_.current.contains(n.target)||(b.focus(M.current),G?ue():ce()));var n}},Oe,H("root")),e.createElement("div",Le,Ne,De,ke,Ae)})));M.displayName="CascadeSelect";export{M as CascadeSelect};
